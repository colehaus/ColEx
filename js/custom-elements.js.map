{"version":3,"sources":["webpack:///./custom-elements/menu.wp.es.js","webpack:///./custom-elements/tree.wp.es.js","webpack:///./custom-elements/swap.wp.es.js","webpack:///./libs/geometry.wp.es.js","webpack:///./custom-elements/sidenote.wp.es.js"],"names":["S","Object","__WEBPACK_IMPORTED_MODULE_1_sanctuary__","checkTypes","env","getMenu","el","__WEBPACK_IMPORTED_MODULE_0_jquery___default","closest","attr","renderMenuItem","menuItem","tag","li","text","label","type","active","removeAttr","Error","toString","renderMenu","menu","append","map","items","fixTarget","target","HTMLElement","parseMenu","data","get","nodeName","parseMenuItem","children","toArray","handleEvent","event","pipe","toMaybe","maybe_","remove","menuDom","item","toggleMenu","ev","some","tg","filter","_","isPopup","each","click","__webpack_exports__","defaultHandlers","find","choose","contentTree","contentBranch","index","hasClass","parent","is","from","siblings","to","Promise","resolve","reject","removeClass","addClass","event_","pho","height","stepDuration","stretch","then","heightFn","__WEBPACK_IMPORTED_MODULE_2_d3__","__WEBPACK_IMPORTED_MODULE_5_libs_util__","prog","css","fadeIn","cleanUp","fadeOut","all","__WEBPACK_IMPORTED_MODULE_4_custom_elements_sidenote__","setNotes","fixNotes","__WEBPACK_IMPORTED_MODULE_3_custom_elements_menu__","pageY","pageX","offset","top","left","off","MathJax","Hub","Queue","inlines","swap","arrow","this","p","selector","replace","bottom","nextAll","prevAll","topEl","bottomEl","betweenEls","nextUntil","bottomToTop","between","topToBottom","translations","angle","Math","PI","mkTranslator","trans","startAngle","center","radius","__WEBPACK_IMPORTED_MODULE_4_libs_geometry__","x","y","topTranslator","bottomTranslator","betweenTranslator","__WEBPACK_IMPORTED_MODULE_3_libs_util__","swapTranslate","swapDom","__WEBPACK_IMPORTED_MODULE_2_custom_elements_sidenote__","decorate","bot","topNext","next","before","up","down","swaps","groupBy","on","equals","forEach","group","tail","prepend","clone","init","circleFromChord","startRads","stopRads","startCoord","stopCoord","coord1","coord2","hypot","distance","sin","abs","pointOnCircle","cos","getReferrer","id","slice","maybeToNullable","last","reduce","prevBot","_el","_1","outerHeight","ref","max","prev","hide","observer","observe","attributes","not","referrer","noted","length","html","addSidenote","MutationObserver","addOrRemoveNotes","window","width","parseFloat","document","fonts","ready","disconnect","show","resize"],"mappings":"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","file":"custom-elements.js","sourcesContent":["// @flow\n/* eslint no-undef: \"off\" */\n\nimport $ from 'jquery'\nimport {create, env} from 'sanctuary'\nconst S = create({checkTypes: false, env})\n\nconst defaultHandlers = (el: JQuery) => {\n  if (el.attr('type') === 'radio') {\n    const menu = el.closest('menu')\n    const item = menu.find(`[label=\"${el.text()}\"]`)\n    handleEvent({ tag: 'ITEMSELECT', menu, item })\n  }\n}\n\nconst getMenu = (el: HTMLElement) => $('#' + $(el).closest('[type=\"menu\"]').attr('data-menu'))\n\nconst renderMenuItem = (menuItem: MenuItem): JQuery => {\n  switch (menuItem.tag) {\n    case 'HR':\n      return $('<hr/>')\n    case 'MENUITEM':\n      const li = $('<li/>').text(menuItem.label).attr('type', menuItem.type)\n      if (menuItem.active) {\n        li.attr('checked', 'checked')\n      } else {\n        li.removeAttr('checked')\n      }\n      return li\n    default:\n      throw Error(menuItem.toString())\n  }\n}\n\nconst renderMenu = (menu: Menu): ?JQuery => {\n  switch (menu.tag) {\n    case 'CLOSED':\n      return null\n    case 'OPEN':\n      return $('<ul class=\"menu\"></ul>').append(S.map(renderMenuItem)(menu.items))\n  }\n}\n\ntype MenuItemType = 'radio' | string\n\ntype MenuItem\n  = { tag: 'HR' }\n  | { tag: 'MENUITEM', label: string, type: MenuItemType, active: boolean }\n\ntype Menu\n  = { tag: 'OPEN', items: Array<MenuItem> }\n  | { tag: 'CLOSED' }\n\n// The JQuery declaration seems to be wrong\nconst fixTarget = (target: EventTarget) => HTMLElement = (target: any) // eslint-disable-line no-return-assign\n\nconst parseMenuItem = (menuItem: JQuery): MenuItem => {\n  switch (menuItem.get(0).nodeName) {\n    case 'HR':\n      return { tag: 'HR' }\n    case 'MENUITEM':\n      return { tag: 'MENUITEM',\n        label: menuItem.attr('label'),\n        type: menuItem.attr('type'),\n        active: menuItem.attr('checked') === 'checked'\n      }\n    default:\n      throw Error(menuItem.toString())\n  }\n}\n\nconst parseMenu = (menu: JQuery): Menu =>\n  menu.data('active')\n  ? { tag: 'CLOSED' }\n  : { tag: 'OPEN',\n    items: S.map((el) => parseMenuItem($(el)))(menu.children('menuitem, hr').toArray())\n  }\n\ntype Event\n  = { tag: 'MENUCLICK', menu: JQuery }\n  | { tag: 'ITEMSELECT', item: JQuery, menu: JQuery }\n\nconst handleEvent = (event: Event) => {\n  switch (event.tag) {\n    case 'MENUCLICK':\n      S.pipe([\n        parseMenu,\n        renderMenu,\n        S.toMaybe,\n        S.maybe_(\n          () => {\n            $('ul.menu').remove()\n            event.menu.data('active', false)\n          })(\n          menuDom => {\n            event.menu.append(menuDom)\n            event.menu.data('active', true)\n          }\n        )\n      ])(\n        event.menu\n      )\n      break\n    case 'ITEMSELECT':\n      $('ul.menu').remove()\n      event.menu.data('active', false)\n      S.map(el => $(el).removeAttr('checked'))(event.menu.children().toArray())\n      event.item.attr('checked', 'checked')\n      break\n  }\n}\n\nconst toggleMenu = (ev: JQueryEventObject) => {\n  // Menu shouldn't popup when clicking on interactive element\n  const isInter = [\n    'TEXTAREA',\n    'BUTTON',\n    'INPUT',\n    'OPTION',\n    'SELECT',\n    'DETAILS',\n    'SUMMARY',\n    'A'\n  ].some(tg => fixTarget(ev.target).nodeName === tg)\n  if (isInter) { return }\n  const isPopup = el =>\n    $(el).get(0).nodeName === 'MENU' && $(el).attr('type') === 'popup'\n  const menu = getMenu(fixTarget(ev.target)).filter((_, el) => isPopup(el))\n  if (menu != null) {\n    handleEvent({ tag: 'MENUCLICK', menu: $(menu) })\n  }\n}\n\n$(() => {\n  $('[type=\"menu\"]').each((_, el) => {\n    $(el).click(toggleMenu)\n  })\n})\n\nexport default {getMenu, defaultHandlers}\n\n\n\n// WEBPACK FOOTER //\n// ./custom-elements/menu.wp.es.js","// @flow\n/* eslint no-undef: \"off\" */\n\nimport $ from 'jquery'\nimport {create, env} from 'sanctuary'\nimport { interpolateNumber } from 'd3'\n\nimport menu from 'custom-elements/menu'\nimport sidenote from 'custom-elements/sidenote'\nimport { makeAnimationPromise } from 'libs/util'\n\nconst S = create({checkTypes: false, env})\n\ntype Event\n  = { tag: 'INVISIBLEPARENT', from: JQuery, to: JQuery }\n  | { tag: 'SELECTEDOPEN' }\n  | { tag: 'SELECTEDNEWVISIBLE', from: JQuery, to: JQuery, parent: JQuery }\n\nconst handleEvent = (event: Event) => (resolve: Function, reject: Function) => {\n  switch (event.tag) {\n    case 'INVISIBLEPARENT':\n      event.from.removeClass('open')\n      event.to.addClass('open')\n      resolve()\n      break\n    case 'SELECTEDOPEN':\n      resolve()\n      break\n    case 'SELECTEDNEWVISIBLE':\n      // Flow behaving badly\n      const event_ = event\n      const pho = event_.parent.height()\n      const stepDuration = 300 // ms\n      const fadeOut = () =>\n        makeAnimationPromise(stepDuration, prog => event_.from.css('opacity', 1 - prog))\n          .then(() => {\n            event_.from.css('opacity', 0)\n            event_.from.removeClass('open')\n          })\n      const stretch = () =>\n        Promise.resolve()\n          .then(() => {\n            const heightFn = interpolateNumber(pho, event_.parent.height())\n            return makeAnimationPromise(stepDuration, prog => {\n              event_.parent.css('height', heightFn(prog))\n            })\n          })\n      const fadeIn = () =>\n        Promise.resolve()\n          .then(() => {\n            event_.to.css('opacity', 0)\n            event_.to.addClass('open')\n            return makeAnimationPromise(stepDuration, prog => {\n              event_.to.css('opacity', prog)\n            })\n          })\n      const cleanUp = () => {\n        event_.parent.removeAttr('style')\n        event_.from.removeAttr('style')\n        event_.to.removeAttr('style')\n      }\n      fadeOut()\n        .then(() => Promise.all([fadeIn(), stretch()]))\n        .then(cleanUp)\n        .then(resolve)\n      break\n  }\n}\n\nconst choose = (ev: JQueryEventObject) => {\n  const el = $(ev.target)\n  S.map(\n    contentTree => {\n      const contentBranch = $($(contentTree).children().get(el.index()))\n      const event =\n        contentBranch.hasClass('open')\n          ? { tag: 'SELECTEDOPEN' }\n          : contentBranch.parent().is(':visible')\n            ? { tag: 'SELECTEDNEWVISIBLE', from: contentBranch.siblings('.open'), to: contentBranch, parent: contentBranch.parent() }\n            : { tag: 'INVISIBLEPARENT', from: contentBranch.siblings('.open'), to: contentBranch }\n      new Promise(handleEvent(event)).then(() => {\n        sidenote.setNotes()\n        sidenote.fixNotes()\n      })\n    }\n  )(\n    $(`[data-menu=\"${el.closest('menu').attr('id')}\"]`).toArray()\n  )\n  menu.defaultHandlers(el)\n  return false\n}\n\nconst fixTarget = (target: EventTarget) => HTMLElement = (target: any) // eslint-disable-line no-return-assign\n\n$(() => {\n  S.map(el =>\n    $(el).click(({pageY, pageX, target}) => {\n      menu.getMenu(fixTarget(target))\n      .offset({top: pageY, left: pageX})\n      .children('ul.menu').children()\n      .off().click(choose)\n      return false\n    })\n  )(\n    $('[type=\"menu\"]').toArray()\n  )\n\n  MathJax.Hub.Queue(() => {\n    // Messes up rendering if we add to stylesheet\n    $('.MathJax_MathContainer').css('display', 'inline')\n    $('.MathJax_MathContainer > span').css('display', 'inline')\n    // Re-inline fix rendering problem\n    const inlines = $('.switch.inline > li.open')\n    inlines.css('display', 'inline-block')\n    inlines.offset() // Trigger reflow\n    inlines.css('display', 'inline')\n    inlines.removeAttr('style')\n  })\n})\n\n\n\n// WEBPACK FOOTER //\n// ./custom-elements/tree.wp.es.js","// @flow\n/* eslint no-undef: \"off\" */\n\n// Doesn't currently handle nested swaps\n\nimport $ from 'jquery'\nimport {create, env} from 'sanctuary'\n\nimport sidenote from 'custom-elements/sidenote'\nimport { makeAnimationPromise } from 'libs/util'\nimport { circleFromChord, pointOnCircle } from 'libs/geometry'\n\nconst S = create({checkTypes: false, env})\n\nconst translations = (top: JQuery, bottom: JQuery) => {\n  const bottomToTop = top.offset().top - bottom.offset().top\n  const between = bottom.height() - top.height()\n  const topToBottom = bottom.offset().top - top.offset().top + between\n  return {bottomToTop, between, topToBottom}\n}\n\nconst swapTranslate = (topEl: JQuery, bottomEl: JQuery) => (resolve: Function, reject: Function) => {\n  const betweenEls = topEl.nextUntil(bottomEl)\n  const {bottomToTop, between, topToBottom} = translations(topEl, bottomEl)\n\n  const angle = Math.PI / 4\n  const mkTranslator = (trans: number): (number => string) => {\n    const startAngle = trans <= 0 ? Math.PI + angle : angle\n    const {center, radius} = circleFromChord(startAngle,\n                                             startAngle - 2 * angle,\n                                             {x: 0, y: 0},\n                                             {x: 0, y: trans})\n    return (prog: number): string => {\n      const {x, y} = pointOnCircle(center, radius,\n                                   startAngle - angle * 2 * prog)\n      return `translate(${x}px, ${-y}px)`\n    }\n  }\n  const topTranslator = mkTranslator(topToBottom)\n  const bottomTranslator = mkTranslator(bottomToTop)\n  const betweenTranslator = mkTranslator(between)\n\n  const stepDuration = 300 // ms\n\n  Promise.all([\n    makeAnimationPromise(\n      stepDuration,\n      prog => topEl.css('transform', topTranslator(prog))\n    ).then(() => topEl.removeAttr('style')),\n    makeAnimationPromise(\n      stepDuration,\n      prog => bottomEl.css('transform', bottomTranslator(prog))\n    ).then(() => bottomEl.removeAttr('style')),\n    makeAnimationPromise(\n      stepDuration,\n      prog => betweenEls.css('transform', betweenTranslator(prog))\n    ).then(() => betweenEls.removeAttr('style'))\n  ]).then(resolve)\n}\n\nconst swap = function () {\n  const arrow = $(this)\n  const p = arrow.parent()\n  const selector = '.' + p.attr('class').replace(' ', '.')\n  const [top, bottom] =\n    (arrow.attr('class') === 'swap-down')\n    ? [p, p.nextAll(selector + ':first')]\n    : [p.prevAll(selector + ':first'), p]\n  new Promise(swapTranslate(top, bottom)).then(() => {\n    swapDom(top, bottom)\n    sidenote.fixNotes()\n    $('.swap-up, .swap-down').remove()\n    decorate()\n  })\n}\n\nconst swapDom = (top: JQuery, bot: JQuery) => {\n  const topNext = top.next()\n  if (topNext[0] === bot[0]) {\n    bot.before(top)\n    top.before(bot)\n  } else {\n    bot.before(top)\n    topNext.before(bot)\n  }\n}\n\nconst decorate = () => {\n  const up = $('<span class=\"swap-up\"></span>')\n  const down = $('<span class=\"swap-down\"></span>')\n  const swaps = $('.swap')\n  const swapGroups = S.groupBy(S.on(S.equals)(el => $(el).attr('class')))(swaps.toArray())\n  const decorateGroup = group => {\n    S.pipe([S.tail, S.map(S.map(el => $(el).prepend(up.clone())))])(group)\n    S.pipe([S.init, S.map(S.map(el => $(el).append(down.clone())))])(group)\n  }\n  swapGroups.forEach(decorateGroup)\n  $('.swap-up, .swap-down').click(swap)\n}\n\n$(decorate)\n\n\n\n// WEBPACK FOOTER //\n// ./custom-elements/swap.wp.es.js","// @flow\n/* eslint no-undef: \"off\" */\n\nexport type Coordinate = {x: number, y: number}\n\nconst distance = (coord1: Coordinate, coord2: Coordinate): number =>\n  Math.hypot(coord1.x - coord2.x, coord1.y - coord2.y)\n\nconst circleFromChord = (startRads: number, stopRads: number, startCoord: Coordinate, stopCoord: Coordinate): {radius: number, center: Coordinate} => {\n  const radius = distance(startCoord, stopCoord) /\n    Math.sin(Math.abs(stopRads - startRads) / 2) / 2\n  const center = pointOnCircle(startCoord, radius, startRads + Math.PI)\n  return {radius, center}\n}\n\nconst pointOnCircle = ({x, y}: Coordinate, radius: number, angle: number): Coordinate => ({\n  x: x + Math.cos(angle) * radius,\n  y: y + Math.sin(angle) * radius\n})\n\nexport { distance, circleFromChord, pointOnCircle }\n\n\n\n// WEBPACK FOOTER //\n// ./libs/geometry.wp.es.js","// @flow\n/* eslint no-undef: \"off\" */\n\nimport $ from 'jquery'\nimport {create, env} from 'sanctuary'\nconst S = create({checkTypes: false, env})\n\nconst getReferrer = (el: JQuery): ?JQuery =>\n  S.pipe([\n    S.toMaybe,\n    S.map(id => $('#' + id.slice(1))),\n    S.maybeToNullable\n  ])(\n    el.find('a').last().attr('href')\n  )\n\nconst fixNotes = () => {\n  S.reduce(\n    prevBot => _el => {\n      const el = $(_el)\n      el.offset((_1, {top, left}) =>\n        S.pipe([\n          S.toMaybe,\n          S.maybe_(() => {\n            prevBot = top + el.outerHeight(true)\n            return {top, left}\n          })(\n            ref => {\n              const top = S.max(ref.prev().offset().top)(prevBot)\n              prevBot = top + el.outerHeight(true)\n              return {top, left}\n            }\n          )\n        ])(\n          getReferrer(el)\n        )\n      )\n      return prevBot\n    })(\n    0)(\n    $('.sidenote').toArray())\n}\n\nconst setNotes = () => {\n  const addSidenote = el => {\n    // Putting block elements in a <p> auto-closes it so we put it immediately outside\n    const referrer = getReferrer(el)\n    if (referrer != null) {\n      const noted = referrer.prev()\n      if (noted.is(':visible')) {\n        const p = noted.closest('p');\n        (p.length === 0 ? noted : p).before('<aside class=\"sidenote\">' + $(el).html() + '</aside>')\n      }\n    }\n  }\n  const delink = () => {\n    $('.noted').next().hide()\n    $('.sidenote').each((_, el) => {\n      $(el).find('a').last().hide()\n    })\n  }\n\n  $('.footnotes').hide()\n  $('details').each((_, el) => {\n    observer.observe(el, {attributes: true})\n  })\n  $('.sidenote').not('#warnings').remove()\n  $('.footnotes > ol > li').each((_, el) => {\n    addSidenote($(el))\n  })\n  delink()\n}\n\nconst observer = new MutationObserver(fixNotes)\n\nconst removeNotes = () => {\n  observer.disconnect()\n  $('.sidenote').not('#warnings').remove()\n  $('.noted').next().show()\n  $('.footnotes').show()\n}\n\nconst addOrRemoveNotes = () => {\n  const emWidth = $(window).width() / parseFloat($('html').css('font-size'))\n  if (emWidth > 60) {\n    setNotes()\n    // $FlowFixMe\n    document.fonts.ready.then(fixNotes)\n    MathJax.Hub.Queue(() => {\n      fixNotes()\n    })\n  } else {\n    removeNotes()\n  }\n}\n\n$(() => {\n  addOrRemoveNotes()\n  $(window).resize(addOrRemoveNotes)\n})\n\nexport default {setNotes, fixNotes}\n\n\n\n// WEBPACK FOOTER //\n// ./custom-elements/sidenote.wp.es.js"],"sourceRoot":""}